{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the LocalDink application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "defaultDoubles": {
          "type": "boolean",
          "description": "Default preference for doubles games."
        },
        "homeCourtId": {
          "type": "string",
          "description": "Reference to Court. Default home court of the user. (Relationship: UserProfile 1:N Court)"
        },
        "availability": {
          "type": "string",
          "description": "User's availability for scheduling games."
        },
        "groupIds": {
          "type": "array",
          "description": "References to Groups. Groups the user belongs to. (Relationship: UserProfile N:N Group)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "GameSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameSession",
      "type": "object",
      "description": "Represents a scheduled pickleball game session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the game session."
        },
        "organizerId": {
          "type": "string",
          "description": "Reference to UserProfile. Organizer of the game session. (Relationship: UserProfile 1:N GameSession)"
        },
        "courtId": {
          "type": "string",
          "description": "Reference to Court. Court where the game session is to be played. (Relationship: Court 1:N GameSession)"
        },
        "startTime": {
          "type": "string",
          "description": "Scheduled start time of the game session.",
          "format": "date-time"
        },
        "gameType": {
          "type": "string",
          "description": "Type of game (e.g., singles, doubles)."
        },
        "playerIds": {
          "type": "array",
          "description": "References to UserProfiles. Players participating in the game session. (Relationship: UserProfile N:N GameSession)",
          "items": {
            "type": "string"
          }
        },
        "inviteeIds": {
          "type": "array",
          "description": "References to UserProfiles. Players invited to the game session. (Relationship: UserProfile N:N GameSession)",
          "items": {
            "type": "string"
          }
        },
        "alternateIds": {
          "type": "array",
          "description": "References to UserProfiles. Players on the alternate list for the game session. (Relationship: UserProfile N:N GameSession)",
          "items": {
            "type": "string"
          }
        },
        "cancellationManagement": {
          "type": "string",
          "description": "Cancellation and re-notification details."
        }
      },
      "required": [
        "id",
        "organizerId",
        "courtId",
        "startTime",
        "gameType"
      ]
    },
    "Court": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Court",
      "type": "object",
      "description": "Represents a pickleball court.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the court."
        },
        "name": {
          "type": "string",
          "description": "Name of the court."
        },
        "location": {
          "type": "string",
          "description": "Location of the court (e.g., address)."
        },
        "isHomeCourt": {
          "type": "boolean",
          "description": "Indicates if the court is a home court for a user."
        }
      },
      "required": [
        "id",
        "name",
        "location"
      ]
    },
    "Group": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Group",
      "type": "object",
      "description": "Represents a group of players.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the group."
        },
        "name": {
          "type": "string",
          "description": "Name of the group."
        },
        "memberIds": {
          "type": "array",
          "description": "References to UserProfiles. Members of the group. (Relationship: UserProfile N:N Group)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. User ID from authentication used as document ID. Guarantees ownership. No denormalization required due to path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/gameSessions/{gameSessionId}",
        "definition": {
          "entityName": "GameSession",
          "schema": {
            "$ref": "#/backend/entities/GameSession"
          },
          "description": "Stores game session information. Includes denormalized 'organizerId' field for authorization independence.",
          "params": [
            {
              "name": "gameSessionId",
              "description": "The unique identifier for the game session."
            }
          ]
        }
      },
      {
        "path": "/courts/{courtId}",
        "definition": {
          "entityName": "Court",
          "schema": {
            "$ref": "#/backend/entities/Court"
          },
          "description": "Stores court information.",
          "params": [
            {
              "name": "courtId",
              "description": "The unique identifier for the court."
            }
          ]
        }
      },
      {
        "path": "/groups/{groupId}",
        "definition": {
          "entityName": "Group",
          "schema": {
            "$ref": "#/backend/entities/Group"
          },
          "description": "Stores group information. Access control based on member list.",
          "params": [
            {
              "name": "groupId",
              "description": "The unique identifier for the group."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the LocalDink application's core features, emphasizing authorization independence, clear access modeling, and data clarity. The design denormalizes authorization data to avoid using `get()` calls in security rules, simplifying rules and enabling atomic operations.  \n\n1.  **User Profiles:** User profiles are stored in a path-based structure under `/users/{userId}`. This pattern enforces strict ownership, making security rules straightforward.\n2.  **Game Sessions:** Game sessions are organized under `/gameSessions/{gameSessionId}`. Access is controlled via the denormalized `organizerId` field, which is duplicated in the document, enabling independent authorization without needing to fetch the organizer's information.  The `playerIds`, `inviteeIds`, and `alternateIds` are arrays, providing a record of relationships between users and game sessions.\n3.  **Courts:** Courts are stored in a top-level collection `/courts/{courtId}`.  This makes courts globally accessible, enabling easy querying for available courts.\n4.  **Groups:** Groups are stored in a top-level collection `/groups/{groupId}`. The `memberIds` field stores an array of user IDs for group membership, enabling efficient group management and querying.\n\n**Authorization Independence:**\n\n*   **User Profiles:** Stored under `/users/{userId}`, ensuring that access control is based solely on the authenticated user ID (`request.auth.uid`).\n*   **Game Sessions:** The `organizerId` field is denormalized to each game session document. This allows security rules to validate if the requesting user is the organizer without performing a `get()` operation.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure enables secure `list` operations by avoiding the need to filter based on data in other documents. For example, listing game sessions requires no parent document lookups.\n\n**Invariants:**\n\n*   Ownership of UserProfiles is guaranteed by the path structure `/users/{userId}`.\n    "
  }
}